
include:
  - ./ldap/docker-compose.yml
  - ./mailhog/docker-compose.yml
  - ./postgres/docker-compose.yml

services:
  realm-setup:
    extends:
      file: ./keycloak/docker-compose.yml
      service: realm-setup

  keycloak:
    extends:
      file: ./keycloak/docker-compose.yml
      service: keycloak
    env_file:
      - ./.env
    depends_on:
      realm-setup:
        condition: service_completed_successfully
      postgres:
        condition: service_healthy
      mailhog:
        condition: service_healthy
      openldap:
        condition: service_healthy

  keycloak_setup:
    extends:
      file: ./keycloak/docker-compose.yml
      service: keycloak_setup

volumes:
  keycloak_data: