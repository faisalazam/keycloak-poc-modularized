{
	"info": {
		"_postman_id": "10ebb47a-2700-43ba-b4d9-2129bf9354b2",
		"name": "Keycloak",
		"schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json",
		"_exporter_id": "39468559"
	},
	"item": [
		{
			"name": "Login",
			"item": [
				{
					"name": "Login - Admin",
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/x-www-form-urlencoded"
							}
						],
						"body": {
							"mode": "urlencoded",
							"urlencoded": [
								{
									"key": "client_id",
									"value": "{{ADMIN_CLIENT_ID}}"
								},
								{
									"key": "username",
									"value": "admin"
								},
								{
									"key": "password",
									"value": "admin"
								},
								{
									"key": "grant_type",
									"value": "password"
								}
							]
						},
						"url": {
							"raw": "{{BASE_URL}}/realms/{{ADMIN_REALM_NAME}}/protocol/openid-connect/token",
							"host": [
								"{{BASE_URL}}"
							],
							"path": [
								"realms",
								"{{ADMIN_REALM_NAME}}",
								"protocol",
								"openid-connect",
								"token"
							]
						}
					},
					"response": [],
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test('Status code is 200', function () {",
									"    pm.response.to.have.status(200);",
									"});",
									"",
									"pm.test('Response body contains access token', function () {",
									"    var jsonData = pm.response.json();",
									"    pm.expect(jsonData).to.have.property('access_token');",
									"});",
									"",
									"pm.test('Log token for debugging', function () {",
									"    var jsonData = pm.response.json();",
									"    console.log('Admin Access Token:', jsonData.access_token);",
									"});",
									"",
									"pm.test('Handle error if status code is not 200', function () {",
									"    if (pm.response.status !== 200) {",
									"        console.error('Error: Expected 200 but got', pm.response.status);",
									"        throw new Error('Unexpected status code: ' + pm.response.status);",
									"    }",
									"});"
								]
							}
						}
					]
				},
				{
					"name": "Login - User",
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/x-www-form-urlencoded"
							}
						],
						"body": {
							"mode": "urlencoded",
							"urlencoded": [
								{
									"key": "client_id",
									"value": "{{CLIENT_ID}}"
								},
								{
									"key": "username",
									"value": "kzuser1"
								},
								{
									"key": "password",
									"value": "password1"
								},
								{
									"key": "grant_type",
									"value": "password"
								}
							]
						},
						"url": {
							"raw": "{{BASE_URL}}/realms/{{USER_REALM_NAME}}/protocol/openid-connect/token",
							"host": [
								"{{BASE_URL}}"
							],
							"path": [
								"realms",
								"{{USER_REALM_NAME}}",
								"protocol",
								"openid-connect",
								"token"
							]
						}
					},
					"response": [],
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test('Status code is 200', function () {",
									"    pm.response.to.have.status(200);",
									"});",
									"",
									"pm.test('Response body contains access token', function () {",
									"    var jsonData = pm.response.json();",
									"    pm.expect(jsonData).to.have.property('access_token');",
									"});",
									"",
									"pm.test('Log token for debugging', function () {",
									"    var jsonData = pm.response.json();",
									"    console.log('User Access Token:', jsonData.access_token);",
									"});",
									"",
									"pm.test('Handle error if status code is not 200', function () {",
									"    if (pm.response.status !== 200) {",
									"        console.error('Error: Expected 200 but got', pm.response.status);",
									"        throw new Error('Unexpected status code: ' + pm.response.status);",
									"    }",
									"});"
								]
							}
						}
					]
				}
			]
		},
		{
			"name": "Logout",
			"item": [
				{
					"name": "1 - Login - User",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"try {",
									"    var jsonData = pm.response.json();",
									"    const currentFolder = FolderNames.logoutFolder;",
									"    FolderVariables.setVariable(pm, currentFolder, \"REFRESH_TOKEN\", jsonData.refresh_token);",
									"",
									"    console.log(`REFRESH_TOKEN for ${currentFolder} set to: ${jsonData.refresh_token}`);",
									"",
									"    // Test to ensure token is set",
									"    pm.test(\"Login - User: Refresh token retrieved and stored\", function () {",
									"        pm.expect(jsonData.refresh_token).to.exist;",
									"        pm.expect(FolderVariables.getVariable(pm, currentFolder, \"REFRESH_TOKEN\")).to.eql(jsonData.refresh_token);",
									"    });",
									"} catch (e) {",
									"    pm.test(\"Login - User: Error in setting refresh token\", function () {",
									"        throw new Error(\"Failed to parse refresh token from response\");",
									"    });",
									"}"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/x-www-form-urlencoded"
							}
						],
						"body": {
							"mode": "urlencoded",
							"urlencoded": [
								{
									"key": "client_id",
									"value": "{{CLIENT_ID}}"
								},
								{
									"key": "username",
									"value": "kzuser1"
								},
								{
									"key": "password",
									"value": "password1"
								},
								{
									"key": "grant_type",
									"value": "password"
								}
							]
						},
						"url": {
							"raw": "{{BASE_URL}}/realms/{{USER_REALM_NAME}}/protocol/openid-connect/token",
							"host": ["{{BASE_URL}}"],
							"path": ["realms", "{{USER_REALM_NAME}}", "protocol", "openid-connect", "token"]
						}
					},
					"response": []
				},
				{
					"name": "2 - Logout - User",
					"event": [
						{
							"listen": "prerequest",
							"script": {
								"exec": [
									"try {",
									"    const currentFolder = FolderNames.logoutFolder;",
									"    const refreshToken = FolderVariables.getVariable(pm, currentFolder, \"REFRESH_TOKEN\");",
									"",
									"    if (refreshToken) {",
									"        pm.environment.set(\"REFRESH_TOKEN\", refreshToken);",
									"        console.log(`Using REFRESH_TOKEN for logout: ${refreshToken}`);",
									"    } else {",
									"        throw new Error(\"REFRESH_TOKEN is not set in folder-level variables\");",
									"    }",
									"} catch (e) {",
									"    console.error(e.message);",
									"    pm.test(\"Logout - User: Error setting refresh token\", function () {",
									"        throw new Error(\"Failed to set REFRESH_TOKEN before logout\");",
									"    });",
									"}"
								],
								"type": "text/javascript"
							}
						},
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Logout - User: Logout request successful\", function () {",
									"    pm.response.to.have.status(204);",
									"    console.log(\"Logout - User: Successfully logged out with 204 status.\");",
									"});",
									"",
									"pm.test('Handle error if status code is not 204', function () {",
									"    if (pm.response.status !== 204) {",
									"        console.error('Error: Expected 204 but got', pm.response.status);",
									"        throw new Error('Unexpected status code: ' + pm.response.status);",
									"    }",
									"});",
									"",
									"pm.environment.unset(\"REFRESH_TOKEN\");",
									"console.log(\"REFRESH_TOKEN cleared from environment\");"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/x-www-form-urlencoded"
							}
						],
						"body": {
							"mode": "urlencoded",
							"urlencoded": [
								{
									"key": "client_id",
									"value": "{{CLIENT_ID}}"
								},
								{
									"key": "refresh_token",
									"value": "{{REFRESH_TOKEN}}"
								}
							]
						},
						"url": {
							"raw": "{{BASE_URL}}/realms/{{USER_REALM_NAME}}/protocol/openid-connect/logout",
							"host": ["{{BASE_URL}}"],
							"path": ["realms", "{{USER_REALM_NAME}}", "protocol", "openid-connect", "logout"]
						}
					}
				}
			]
		},
		{
			"name": "Get User Info",
			"item": [
				{
					"name": "1 - Login - Admin",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"var jsonData = pm.response.json();\r",
									"pm.environment.set(\"ADMIN_ACCESS_TOKEN\", jsonData.access_token);\r",
									""
								],
								"type": "text/javascript",
								"packages": {}
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/x-www-form-urlencoded"
							}
						],
						"body": {
							"mode": "urlencoded",
							"urlencoded": [
								{
									"key": "client_id",
									"value": "{{ADMIN_CLIENT_ID}}"
								},
								{
									"key": "username",
									"value": "admin"
								},
								{
									"key": "password",
									"value": "admin"
								},
								{
									"key": "grant_type",
									"value": "password"
								}
							]
						},
						"url": {
							"raw": "{{BASE_URL}}/realms/{{ADMIN_REALM_NAME}}/protocol/openid-connect/token",
							"host": [
								"{{BASE_URL}}"
							],
							"path": [
								"realms",
								"{{ADMIN_REALM_NAME}}",
								"protocol",
								"openid-connect",
								"token"
							]
						}
					},
					"response": []
				},
				{
					"name": "2 - Get User - Admin",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"var jsonData = pm.response.json();\r",
									"pm.environment.set(\"USER_ID\", jsonData[0].id);\r",
									"pm.environment.set(\"USER_NAME\", jsonData[0].username);\r",
									""
								],
								"type": "text/javascript",
								"packages": {}
							}
						}
					],
					"protocolProfileBehavior": {
						"disableBodyPruning": true
					},
					"request": {
						"method": "GET",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/x-www-form-urlencoded"
							},
							{
								"key": "Authorization",
								"value": "Bearer {{ADMIN_ACCESS_TOKEN}}",
								"type": "text"
							}
						],
						"body": {
							"mode": "urlencoded",
							"urlencoded": [
								{
									"key": "client_id",
									"value": "{{CLIENT_ID}}"
								},
								{
									"key": "username",
									"value": "kzuser1"
								},
								{
									"key": "password",
									"value": "password1"
								},
								{
									"key": "grant_type",
									"value": "password"
								}
							]
						},
						"url": {
							"raw": "{{BASE_URL}}/admin/realms/{{USER_REALM_NAME}}/users?username=user3",
							"host": [
								"{{BASE_URL}}"
							],
							"path": [
								"admin",
								"realms",
								"{{USER_REALM_NAME}}",
								"users"
							],
							"query": [
								{
									"key": "username",
									"value": "user3"
								}
							]
						}
					},
					"response": []
				}
			]
		},
		{
			"name": "Refresh Token",
			"item": [
				{
					"name": "1 - Login - User",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"var jsonData = pm.response.json();\r",
									"pm.environment.set(\"refresh_token\", jsonData.refresh_token);\r",
									""
								],
								"type": "text/javascript",
								"packages": {}
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/x-www-form-urlencoded"
							}
						],
						"body": {
							"mode": "urlencoded",
							"urlencoded": [
								{
									"key": "client_id",
									"value": "{{CLIENT_ID}}"
								},
								{
									"key": "username",
									"value": "kzuser1"
								},
								{
									"key": "password",
									"value": "password1"
								},
								{
									"key": "grant_type",
									"value": "password"
								}
							]
						},
						"url": {
							"raw": "{{BASE_URL}}/realms/{{USER_REALM_NAME}}/protocol/openid-connect/token",
							"host": [
								"{{BASE_URL}}"
							],
							"path": [
								"realms",
								"{{USER_REALM_NAME}}",
								"protocol",
								"openid-connect",
								"token"
							]
						}
					},
					"response": []
				},
				{
					"name": "2 - Refresh Token - User",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"var jsonData = pm.response.json();\r",
									"pm.environment.set(\"refresh_token\", jsonData.refresh_token);\r",
									""
								],
								"type": "text/javascript",
								"packages": {}
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/x-www-form-urlencoded"
							}
						],
						"body": {
							"mode": "urlencoded",
							"urlencoded": [
								{
									"key": "client_id",
									"value": "{{CLIENT_ID}}"
								},
								{
									"key": "refresh_token",
									"value": "{{refresh_token}}"
								},
								{
									"key": "grant_type",
									"value": "refresh_token"
								}
							]
						},
						"url": {
							"raw": "{{BASE_URL}}/realms/{{USER_REALM_NAME}}/protocol/openid-connect/token",
							"host": [
								"{{BASE_URL}}"
							],
							"path": [
								"realms",
								"{{USER_REALM_NAME}}",
								"protocol",
								"openid-connect",
								"token"
							]
						}
					},
					"response": []
				}
			]
		},
		{
			"name": "Update Client Props",
			"item": [
				{
					"name": "1 - Login - Admin",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"var jsonData = pm.response.json();\r",
									"const currentFolder = FolderNames.updateClientPropsFolder;\r",
									"FolderVariables.setVariable(pm, currentFolder, \"ADMIN_ACCESS_TOKEN\", jsonData.access_token);\r",
									""
								],
								"type": "text/javascript",
								"packages": {}
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/x-www-form-urlencoded"
							}
						],
						"body": {
							"mode": "urlencoded",
							"urlencoded": [
								{
									"key": "client_id",
									"value": "{{ADMIN_CLIENT_ID}}"
								},
								{
									"key": "username",
									"value": "admin"
								},
								{
									"key": "password",
									"value": "admin"
								},
								{
									"key": "grant_type",
									"value": "password"
								}
							]
						},
						"url": {
							"raw": "{{BASE_URL}}/realms/{{ADMIN_REALM_NAME}}/protocol/openid-connect/token",
							"host": [
								"{{BASE_URL}}"
							],
							"path": [
								"realms",
								"{{ADMIN_REALM_NAME}}",
								"protocol",
								"openid-connect",
								"token"
							]
						}
					},
					"response": []
				},
				{
					"name": "2 - Client Info - Admin",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"var jsonData = pm.response.json();\r",
									"\r",
									"const currentFolder = FolderNames.updateClientPropsFolder;\r",
									"\r",
									"FolderVariables.setVariable(pm, currentFolder, \"CLIENT_UUID\", jsonData[0].id);\r",
									"\r",
									"\r",
									"const clientUUID = FolderVariables.getVariable(pm, currentFolder, \"CLIENT_UUID\");\r",
									"console.log(`CLIENT_UUID for ${currentFolder} is:`, clientUUID);"
								],
								"type": "text/javascript",
								"packages": {}
							}
						},
						{
							"listen": "prerequest",
							"script": {
								"exec": [
									"const currentFolder = FolderNames.updateClientPropsFolder;\r",
									"const accessToken = FolderVariables.getVariable(pm, currentFolder, \"ADMIN_ACCESS_TOKEN\");\r",
									"pm.environment.set(\"ADMIN_ACCESS_TOKEN\", accessToken);"
								],
								"type": "text/javascript",
								"packages": {}
							}
						}
					],
					"request": {
						"method": "GET",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{ADMIN_ACCESS_TOKEN}}",
								"type": "text"
							}
						],
						"url": {
							"raw": "{{BASE_URL}}/admin/realms/{{USER_REALM_NAME}}/clients?clientId={{CLIENT_ID}}",
							"host": [
								"{{BASE_URL}}"
							],
							"path": [
								"admin",
								"realms",
								"{{USER_REALM_NAME}}",
								"clients"
							],
							"query": [
								{
									"key": "clientId",
									"value": "{{CLIENT_ID}}"
								}
							]
						}
					},
					"response": []
				},
				{
					"name": "3 - Update Client - Admin",
					"event": [
						{
							"listen": "prerequest",
							"script": {
								"exec": [
									"const currentFolder = FolderNames.updateClientPropsFolder;\r",
									"const clientUUID = FolderVariables.getVariable(pm, currentFolder, \"CLIENT_UUID\");\r",
									"pm.environment.set(\"CLIENT_UUID\", clientUUID);\r",
									"\r",
									"const accessToken = FolderVariables.getVariable(pm, currentFolder, \"ADMIN_ACCESS_TOKEN\");\r",
									"pm.environment.set(\"ADMIN_ACCESS_TOKEN\", accessToken);"
								],
								"type": "text/javascript",
								"packages": {}
							}
						},
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.environment.unset(\"CLIENT_UUID\");\r",
									"pm.environment.unset(\"ADMIN_ACCESS_TOKEN\");"
								],
								"type": "text/javascript",
								"packages": {}
							}
						}
					],
					"request": {
						"method": "PUT",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{ADMIN_ACCESS_TOKEN}}",
								"type": "text"
							},
							{
								"key": "Content-Type",
								"value": "application/json",
								"type": "text"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\r\n  \"publicClient\": true,\r\n  \"serviceAccountsEnabled\": false,\r\n  \"standardFlowEnabled\": false,\r\n  \"directAccessGrantsEnabled\": true\r\n}",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{BASE_URL}}/admin/realms/{{USER_REALM_NAME}}/clients/{{CLIENT_UUID}}",
							"host": [
								"{{BASE_URL}}"
							],
							"path": [
								"admin",
								"realms",
								"{{USER_REALM_NAME}}",
								"clients",
								"{{CLIENT_UUID}}"
							]
						}
					},
					"response": []
				}
			]
		},
		{
			"name": "Delete User",
			"item": [
				{
					"name": "1 - Login - Admin",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"var jsonData = pm.response.json();",
									"const currentFolder = FolderNames.deleteUserFolder;",
									"if (jsonData && jsonData.access_token) {",
									"    FolderVariables.setVariable(pm, currentFolder, \"ADMIN_ACCESS_TOKEN\", jsonData.access_token);",
									"    console.log('Admin access token set successfully.');",
									"} else {",
									"    console.error('Error: No access token found in response.');",
									"    pm.test('Admin Login: Access token should be present', function () {",
									"        pm.expect(jsonData.access_token).to.exist;",
									"    });",
									"}"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/x-www-form-urlencoded",
								"type": "text"
							}
						],
						"body": {
							"mode": "urlencoded",
							"urlencoded": [
								{
									"key": "client_id",
									"value": "{{ADMIN_CLIENT_ID}}",
									"type": "text"
								},
								{
									"key": "username",
									"value": "admin",
									"type": "text"
								},
								{
									"key": "password",
									"value": "admin",
									"type": "text"
								},
								{
									"key": "grant_type",
									"value": "password",
									"type": "text"
								}
							]
						},
						"url": {
							"raw": "{{BASE_URL}}/realms/{{ADMIN_REALM_NAME}}/protocol/openid-connect/token",
							"host": [
								"{{BASE_URL}}"
							],
							"path": [
								"realms",
								"{{ADMIN_REALM_NAME}}",
								"protocol",
								"openid-connect",
								"token"
							]
						}
					}
				},
				{
					"name": "2 - Get User (Name) - Admin",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.environment.unset(\"ADMIN_ACCESS_TOKEN\");",
									"const username = pm.request.url.query.get(\"username\");",
									"const user = Utilities.getUserIdByCriteria(pm, username, \"username\");",
									"if (user && user.userId) {",
									"    const currentFolder = FolderNames.deleteUserFolder;",
									"    FolderVariables.setVariable(pm, currentFolder, \"USER_ID\", user.userId);",
									"    console.log(`USER_ID for ${currentFolder} is:`, user.userId);",
									"} else {",
									"    console.error('Error: User not found or userId is missing.');",
									"    pm.test('User retrieval test', function () {",
									"        pm.expect(user).to.exist;",
									"        pm.expect(user.userId).to.exist;",
									"    });",
									"}"
								],
								"type": "text/javascript"
							}
						},
						{
							"listen": "prerequest",
							"script": {
								"exec": [
									"const currentFolder = FolderNames.deleteUserFolder;",
									"const accessToken = FolderVariables.getVariable(pm, currentFolder, \"ADMIN_ACCESS_TOKEN\");",
									"if (accessToken) {",
									"    pm.environment.set(\"ADMIN_ACCESS_TOKEN\", accessToken);",
									"    console.log('Admin access token set in environment.');",
									"} else {",
									"    console.error('Error: Admin access token not found in environment.');",
									"}"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "GET",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/x-www-form-urlencoded",
								"type": "text"
							},
							{
								"key": "Authorization",
								"value": "Bearer {{ADMIN_ACCESS_TOKEN}}",
								"type": "text"
							}
						],
						"url": {
							"raw": "{{BASE_URL}}/admin/realms/{{USER_REALM_NAME}}/users?username=user8",
							"host": [
								"{{BASE_URL}}"
							],
							"path": [
								"admin",
								"realms",
								"{{USER_REALM_NAME}}",
								"users"
							],
							"query": [
								{
									"key": "username",
									"value": "user8"
								}
							]
						}
					}
				},
				{
					"name": "3 - Delete User - Admin",
					"event": [
						{
							"listen": "prerequest",
							"script": {
								"exec": [
									"const currentFolder = FolderNames.deleteUserFolder;",
									"const userId = FolderVariables.getVariable(pm, currentFolder, \"USER_ID\");",
									"if (userId) {",
									"    pm.environment.set(\"USER_ID\", userId);",
									"    console.log(`User ID set for deletion: ${userId}`);",
									"} else {",
									"    console.error('Error: User ID not found for deletion.');",
									"    pm.test('User ID should be available for deletion', function () {",
									"        pm.expect(userId).to.exist;",
									"    });",
									"}"
								],
								"type": "text/javascript"
							}
						},
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.environment.unset(\"USER_ID\");",
									"pm.environment.unset(\"ADMIN_ACCESS_TOKEN\");",
									"pm.test(\"Delete User - Admin: User should be deleted successfully\", function () {",
									"    pm.response.to.have.status(204);",
									"    console.log('User successfully deleted with status code 204.');",
									"});",
									"pm.test('Ensure no unexpected error during deletion', function () {",
									"    if (pm.response.status !== 204) {",
									"        console.error('Error: Unexpected status code during user deletion: ' + pm.response.status);",
									"    }",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "DELETE",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{ADMIN_ACCESS_TOKEN}}",
								"type": "text"
							}
						],
						"url": {
							"raw": "{{BASE_URL}}/admin/realms/{{USER_REALM_NAME}}/users/{{USER_ID}}",
							"host": [
								"{{BASE_URL}}"
							],
							"path": [
								"admin",
								"realms",
								"{{USER_REALM_NAME}}",
								"users",
								"{{USER_ID}}"
							]
						}
					}
				}
			]
		},
		{
			"name": "Reset/Forgot Password via Email",
			"item": [
				{
					"name": "1 - Login - Admin",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"var jsonData = pm.response.json();\r",
									"const currentFolder = FolderNames.forgotPasswordFolder;\r",
									"FolderVariables.setVariable(pm, currentFolder, \"ADMIN_ACCESS_TOKEN\", jsonData.access_token);\r",
									""
								],
								"type": "text/javascript",
								"packages": {}
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/x-www-form-urlencoded",
								"type": "text"
							}
						],
						"body": {
							"mode": "urlencoded",
							"urlencoded": [
								{
									"key": "client_id",
									"value": "{{ADMIN_CLIENT_ID}}",
									"type": "text"
								},
								{
									"key": "username",
									"value": "admin",
									"type": "text"
								},
								{
									"key": "password",
									"value": "admin",
									"type": "text"
								},
								{
									"key": "grant_type",
									"value": "password",
									"type": "text"
								}
							]
						},
						"url": {
							"raw": "{{BASE_URL}}/realms/{{ADMIN_REALM_NAME}}/protocol/openid-connect/token",
							"host": [
								"{{BASE_URL}}"
							],
							"path": [
								"realms",
								"{{ADMIN_REALM_NAME}}",
								"protocol",
								"openid-connect",
								"token"
							]
						}
					},
					"response": []
				},
				{
					"name": "2 - Get User (Email)- Admin",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.environment.unset(\"ADMIN_ACCESS_TOKEN\");\r",
									"\r",
									"const email = pm.request.url.query.get(\"email\");\r",
									"const user = Utilities.getUserIdByCriteria(pm, email, \"email\");\r",
									"\r",
									"const currentFolder = FolderNames.forgotPasswordFolder;\r",
									"\r",
									"FolderVariables.setVariable(pm, currentFolder, \"USER_ID\", user.userId);\r",
									"\r",
									"const userId = FolderVariables.getVariable(pm, currentFolder, \"USER_ID\");\r",
									"console.log(`USER_ID for ${currentFolder} is:`, userId);\r",
									""
								],
								"type": "text/javascript",
								"packages": {}
							}
						},
						{
							"listen": "prerequest",
							"script": {
								"exec": [
									"const currentFolder = FolderNames.forgotPasswordFolder;\r",
									"const accessToken = FolderVariables.getVariable(pm, currentFolder, \"ADMIN_ACCESS_TOKEN\");\r",
									"pm.environment.set(\"ADMIN_ACCESS_TOKEN\", accessToken);"
								],
								"type": "text/javascript",
								"packages": {}
							}
						}
					],
					"request": {
						"method": "GET",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/x-www-form-urlencoded",
								"type": "text"
							},
							{
								"key": "Authorization",
								"value": "Bearer {{ADMIN_ACCESS_TOKEN}}",
								"type": "text"
							}
						],
						"url": {
							"raw": "{{BASE_URL}}/admin/realms/{{USER_REALM_NAME}}/users?email=kzuser1@example.com",
							"host": [
								"{{BASE_URL}}"
							],
							"path": [
								"admin",
								"realms",
								"{{USER_REALM_NAME}}",
								"users"
							],
							"query": [
								{
									"key": "email",
									"value": "kzuser1@example.com"
								}
							]
						}
					},
					"response": []
				},
				{
					"name": "3 - Update Password - Trigger Email",
					"event": [
						{
							"listen": "prerequest",
							"script": {
								"exec": [
									"const currentFolder = FolderNames.forgotPasswordFolder;\r",
									"const userId = FolderVariables.getVariable(pm, currentFolder, \"USER_ID\");\r",
									"pm.environment.set(\"USER_ID\", userId);\r",
									"\r",
									"const accessToken = FolderVariables.getVariable(pm, currentFolder, \"ADMIN_ACCESS_TOKEN\");\r",
									"pm.environment.set(\"ADMIN_ACCESS_TOKEN\", accessToken);"
								],
								"type": "text/javascript",
								"packages": {}
							}
						},
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.environment.unset(\"USER_ID\");\r",
									"pm.environment.unset(\"ADMIN_ACCESS_TOKEN\");"
								],
								"type": "text/javascript",
								"packages": {}
							}
						}
					],
					"request": {
						"method": "PUT",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json",
								"type": "text"
							},
							{
								"key": "Authorization",
								"value": "Bearer {{ADMIN_ACCESS_TOKEN}}",
								"type": "text"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "[\"UPDATE_PASSWORD\"]\r\n"
						},
						"url": {
							"raw": "{{BASE_URL}}/admin/realms/{{USER_REALM_NAME}}/users/{{USER_ID}}/execute-actions-email",
							"host": [
								"{{BASE_URL}}"
							],
							"path": [
								"admin",
								"realms",
								"{{USER_REALM_NAME}}",
								"users",
								"{{USER_ID}}",
								"execute-actions-email"
							]
						}
					},
					"response": []
				}
			],
			"event": [
				{
					"listen": "prerequest",
					"script": {
						"type": "text/javascript",
						"packages": {},
						"exec": [
							""
						]
					}
				},
				{
					"listen": "test",
					"script": {
						"type": "text/javascript",
						"packages": {},
						"exec": [
							""
						]
					}
				}
			]
		},
		{
			"name": "Reset Password Directly",
			"item": [
				{
					"name": "1 - Login - Admin",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"var jsonData = pm.response.json();",
									"const currentFolder = FolderNames.resetPasswordFolder;",
									"if (jsonData.access_token) {",
									"    FolderVariables.setVariable(pm, currentFolder, \"ADMIN_ACCESS_TOKEN\", jsonData.access_token);",
									"    pm.test('Access token retrieved successfully', function () {",
									"        pm.expect(jsonData.access_token).to.not.be.null;",
									"        pm.expect(jsonData.access_token).to.not.be.undefined;",
									"    });",
									"} else {",
									"    pm.test('Failed to retrieve access token', function () {",
									"        pm.expect(jsonData.access_token).to.not.be.null;",
									"        pm.expect(jsonData.access_token).to.not.be.undefined;",
									"    });",
									"    console.error('Access token not found');",
									"}"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/x-www-form-urlencoded"
							}
						],
						"body": {
							"mode": "urlencoded",
							"urlencoded": [
								{
									"key": "client_id",
									"value": "{{ADMIN_CLIENT_ID}}"
								},
								{
									"key": "username",
									"value": "admin"
								},
								{
									"key": "password",
									"value": "admin"
								},
								{
									"key": "grant_type",
									"value": "password"
								}
							]
						},
						"url": {
							"raw": "{{BASE_URL}}/realms/{{ADMIN_REALM_NAME}}/protocol/openid-connect/token",
							"host": [
								"{{BASE_URL}}"
							],
							"path": [
								"realms",
								"{{ADMIN_REALM_NAME}}",
								"protocol",
								"openid-connect",
								"token"
							]
						}
					},
					"response": []
				},
				{
					"name": "2 - Get User (Email)- Admin",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.environment.unset(\"ADMIN_ACCESS_TOKEN\");",
									"const email = pm.request.url.query.get(\"email\");",
									"console.log(`Fetching user by email: ${email}`);",
									"const user = Utilities.getUserIdByCriteria(pm, email, \"email\");",
									"if (user && user.userId) {",
									"    const currentFolder = FolderNames.resetPasswordFolder;",
									"    FolderVariables.setVariable(pm, currentFolder, \"USER_ID\", user.userId);",
									"    FolderVariables.setVariable(pm, currentFolder, \"USER_NAME\", user.username);",
									"    const userId = FolderVariables.getVariable(pm, currentFolder, \"USER_ID\");",
									"    pm.test('User ID retrieved successfully', function () {",
									"        pm.expect(userId).to.not.be.null;",
									"        pm.expect(userId).to.not.be.undefined;",
									"    });",
									"    console.log(`USER_ID for ${currentFolder} is:`, userId);",
									"} else {",
									"    pm.test('Failed to retrieve User ID', function () {",
									"        pm.expect(user).to.have.property('userId').that.is.not.null;",
									"    });",
									"    console.error('User not found for email:', email);",
									"}"
								],
								"type": "text/javascript"
							}
						},
						{
							"listen": "prerequest",
							"script": {
								"exec": [
									"const currentFolder = FolderNames.resetPasswordFolder;",
									"const accessToken = FolderVariables.getVariable(pm, currentFolder, \"ADMIN_ACCESS_TOKEN\");",
									"if (!accessToken) {",
									"    console.error('Access token is missing. Cannot proceed.');",
									"    pm.test('Access token is missing', function () {",
									"        pm.expect(accessToken).to.not.be.null;",
									"    });",
									"} else {",
									"    pm.environment.set(\"ADMIN_ACCESS_TOKEN\", accessToken);",
									"    console.log('Access token is set for the request');",
									"}"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "GET",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/x-www-form-urlencoded",
								"type": "text"
							},
							{
								"key": "Authorization",
								"value": "Bearer {{ADMIN_ACCESS_TOKEN}}",
								"type": "text"
							}
						],
						"url": {
							"raw": "{{BASE_URL}}/admin/realms/{{USER_REALM_NAME}}/users?email=kzuser1@example.com",
							"host": [
								"{{BASE_URL}}"
							],
							"path": [
								"admin",
								"realms",
								"{{USER_REALM_NAME}}",
								"users"
							],
							"query": [
								{
									"key": "email",
									"value": "kzuser1@example.com"
								}
							]
						}
					},
					"response": []
				},
				{
					"name": "3 - Reset Password",
					"event": [
						{
							"listen": "prerequest",
							"script": {
								"exec": [
									"const currentFolder = FolderNames.resetPasswordFolder;",
									"const userId = FolderVariables.getVariable(pm, currentFolder, \"USER_ID\");",
									"if (!userId) {",
									"    console.error('USER_ID is missing. Cannot reset password.');",
									"    pm.test('USER_ID is missing', function () {",
									"        pm.expect(userId).to.not.be.null;",
									"    });",
									"} else {",
									"    pm.environment.set(\"USER_ID\", userId);",
									"    console.log(`USER_ID is set: ${userId}`);",
									"}",
									"const username = FolderVariables.getVariable(pm, currentFolder, \"USER_NAME\");",
									"pm.environment.set(\"USER_NAME\", username);",
									"const accessToken = FolderVariables.getVariable(pm, currentFolder, \"ADMIN_ACCESS_TOKEN\");",
									"if (!accessToken) {",
									"    console.error('Access token is missing. Cannot reset password.');",
									"    pm.test('Access token is missing', function () {",
									"        pm.expect(accessToken).to.not.be.null;",
									"    });",
									"} else {",
									"    pm.environment.set(\"ADMIN_ACCESS_TOKEN\", accessToken);",
									"    console.log('Access token is set for reset password request');",
									"}"
								],
								"type": "text/javascript"
							}
						},
						{
							"listen": "test",
							"script": {
								"exec": [
									"if (pm.response.code === 204) {",
									"    pm.test('Password reset successfully', function () {",
									"        pm.response.to.have.status(204);",
									"    });",
									"    console.log('Password reset successfully.');",
									"} else {",
									"    console.error('Failed to reset password:', pm.response.body);",
									"    pm.test('Failed to reset password', function () {",
									"        pm.response.to.have.status(204);",
									"    });",
									"}"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "PUT",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							},
							{
								"key": "Authorization",
								"value": "Bearer {{ADMIN_ACCESS_TOKEN}}"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\r\n  \"type\": \"password\",\r\n  \"value\": \"password1\",\r\n  \"temporary\": false\r\n}\r\n"
						},
						"url": {
							"raw": "{{BASE_URL}}/admin/realms/{{USER_REALM_NAME}}/users/{{USER_ID}}/reset-password",
							"host": [
								"{{BASE_URL}}"
							],
							"path": [
								"admin",
								"realms",
								"{{USER_REALM_NAME}}",
								"users",
								"{{USER_ID}}",
								"reset-password"
							]
						}
					},
					"response": []
				}
			]
		}
	],
	"event": [
		{
			"listen": "prerequest",
			"script": {
				"type": "text/javascript",
				"packages": {},
				"exec": [
					"// Collection-level variable manager\r",
					"FolderNames = {\r",
					"    logoutFolder: \"logoutFolder\",\r",
					"    deleteUserFolder: \"deleteUserFolder\",\r",
					"    resetPasswordFolder: \"resetPasswordFolder\",\r",
					"    forgotPasswordFolder: \"forgotPasswordFolder\",\r",
					"    updateClientPropsFolder: \"updateClientPropsFolder\",\r",
					"};\r",
					"\r",
					"FolderVariables = {};\r",
					"FolderVariables.setVariable = (pmInstance, folder, name, value) => {\r",
					"    // Get or create the folder-specific variable object\r",
					"    let folderData = pmInstance.collectionVariables.get(\"FolderData\") || \"{}\";\r",
					"    folderData = JSON.parse(folderData);\r",
					"\r",
					"    // Set variable within the specific folder's object\r",
					"    if (!folderData[folder]) folderData[folder] = {};\r",
					"    folderData[folder][name] = value;\r",
					"\r",
					"    pmInstance.collectionVariables.set(\"FolderData\", JSON.stringify(folderData));\r",
					"};\r",
					"FolderVariables.getVariable = (pmInstance, folder, name) => {\r",
					"    let folderData = pmInstance.collectionVariables.get(\"FolderData\") || \"{}\";\r",
					"    folderData = JSON.parse(folderData);\r",
					"\r",
					"    return folderData[folder] ? folderData[folder][name] : null;\r",
					"};\r",
					"FolderVariables.clearFolderVariables = (pmInstance, folder) => {\r",
					"    let folderData = pmInstance.collectionVariables.get(\"FolderData\") || \"{}\";\r",
					"    folderData = JSON.parse(folderData);\r",
					"\r",
					"    delete folderData[folder];\r",
					"    pmInstance.collectionVariables.set(\"FolderData\", JSON.stringify(folderData));\r",
					"};"
				]
			}
		},
		{
			"listen": "test",
			"script": {
				"type": "text/javascript",
				"packages": {},
				"exec": [
					"// Object.prototype.getUserIdByCriteria = (value, searchBy = 'username') => {...}\r",
					"// pm.getUserIdByCriteria('username', 'username');\r",
					"Utilities = {};\r",
					"Utilities.getUserIdByCriteria = (pmInstance, value, searchBy = 'username') => {\r",
					"    const users = pmInstance.response.json();\r",
					"\r",
					"    // Check if we're searching by email or username\r",
					"    let exactUser;\r",
					"    if (searchBy === 'email') {\r",
					"        exactUser = users.filter(user => user.email === value);\r",
					"    } else {\r",
					"        exactUser = users.filter(user => user.username === value);\r",
					"    }\r",
					"\r",
					"    if (exactUser.length === 1) {\r",
					"        const user = {userId: exactUser[0].id, username: exactUser[0].username};\r",
					"        pmInstance.test(\"Exact user found\", function () {\r",
					"            pmInstance.expect(exactUser[0].username).to.eql(value);\r",
					"        });\r",
					"        return user;\r",
					"    } else {\r",
					"        pmInstance.test(\"Exact user not found or multiple matches\", function () {\r",
					"            pmInstance.expect(exactUser.length).to.eql(1);\r",
					"        });\r",
					"        return undefined;\r",
					"    }\r",
					"};\r",
					"\r",
					"\r",
					""
				]
			}
		}
	],
	"variable": [
		{
			"key": "FolderData",
			"value": ""
		}
	]
}